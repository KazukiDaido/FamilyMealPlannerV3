# Development Rules (for Me + Cursor)

このプロジェクトの共通ルールです。  
AI（Cursor）は本ルールに従って、計画→設計→実装→テスト→ドキュメント更新まで一貫して提案・記録を行います。

---

## 0. 基本姿勢
- 小さく作って早く見せる（アジャイル・スモールステップ）
- 作業前に「要件 / 受入基準 / 影響範囲 / 設計メモ」を出すこと
- 変更しやすい設計・小さなコミット・小さなPR
- 進行や仕様は常に `.md` ファイルに記録して残すこと

---

## 1. 開発プロセス
1. **要件定義**
   - ユーザーストーリーを短く書く
   - 受入基準（Doneの定義）をチェックリストにする
   - 非機能要件（パフォーマンス/セキュリティ/UXなど）があれば追記
   - → `docs/requirements.md` に保存

2. **設計（必要最小限）**
   - データ構造（state形/DBスキーマ）
   - 画面遷移（Figmaリンク or テキスト）
   - 責務の分離方針（UIは表示のみ、ルールはロジック層）
   - APIの契約（エンドポイント/メソッド/型）
   - → `docs/design.md` に保存

3. **実装**
   - feature/◯◯ ブランチで作業
   - 差分は PR として提案（mainに直接push禁止）

4. **テスト**
   - 受入基準に沿って自己チェック
   - エラー時の挙動も確認
   - → `docs/test-report.md` に保存

5. **リリース**
   - mainにマージ（Squash推奨）
   - バージョンタグ付け
   - → `CHANGELOG.md` に追記

6. **ふりかえり**
   - 詰まった点・改善点を記録
   - → `docs/retrospective.md` に保存

---

## 2. Git運用
- `main` は常に動く状態。直接コミット禁止
- ブランチ命名：
  - 機能: `feature/<説明>` 例) `feature/dinner-attendance`
  - 修正: `bugfix/<説明>`
- フロー：
  1. `git switch -c feature/...`
  2. 小さな意味単位でコミット
  3. PR作成（要約＋スクショ＋受入基準自己チェック）
  4. レビュー後 Squash merge
- 事故対応：
  - `git revert <commit>` = 直前取り消し
  - `git reset --hard <commit>` = ローカル巻き戻し（注意）

---

## 3. コード規約
- 名前は意味が伝わる英語（例：`lockTime`, `toggleAttendance`）
- UIは表示だけ。ビジネスルールは別関数へ
- 型エラーやLintエラーは0にしてからコミット
- エラーハンドリング必須（try/catchや`if (!data)`など）

---

## 4. ドキュメント
- **README.md**（AIがPRで更新提案）
  - 概要・機能リスト・技術スタック
  - セットアップ手順
  - スクショ/動画リンク
  - ロードマップ（次の機能）

- **CHANGELOG.md**
  - バージョンごとに変更点を記録

- **/docs フォルダ**
  - `requirements.md` = 要件定義
  - `design.md` = 設計メモ
  - `test-report.md` = テスト結果
  - `retrospective.md` = ふりかえり
  - `troubleshooting.md` = エラー原因と解決法の蓄積

---

## 5. Issue テンプレ
- 概要  
- 背景  
- 受入基準  
- スクショ or モック  
- テスト観点  
- 影響範囲  

---

## 6. プロジェクト固有追記
- 認証方式（例：メール+パスワード、OAuthなど）
- 課金/収益化方針（例：サブスク、広告）
- 配布手順（App Store, Google Play）
- インフラ（Firebase, Supabase など）
- セキュリティ要件

---

## 7. テスト手順（機能追加時必須）
### 基本テストフロー
1. **アプリ起動テスト**
   ```bash
   cd /Users/kazukidaido/FamilyMealPlannerV3
   npx expo run:ios
   ```
   - エラーなく起動すること
   - シミュレーターで正常に表示されること

2. **機能テスト**
   - 新機能の各操作を実行
   - エラーハンドリングの確認
   - UI/UXの動作確認
   - データの永続化確認

3. **回帰テスト**
   - 既存機能が影響を受けていないこと
   - ナビゲーションが正常に動作すること
   - データ整合性の確認

### 家族グループ機能のテスト手順
#### A. 家族グループ作成テスト
1. アプリ起動 → オンボーディング完了
2. 家族タブ → 「新しい家族グループを作成」
3. 家族名入力（例：「田中家」）
4. 設定選択：
   - ✅ ゲスト参加を許可
   - ❌ 参加承認が必要
5. 「家族グループを作成」ボタン押下
6. **期待結果**：
   - 6桁の家族コードが表示される
   - ホーム画面に遷移する
   - 家族名が表示される

#### B. QRコード共有テスト
1. 家族グループ作成済み状態
2. 家族タブ → QRコードアイコン押下
3. **期待結果**：
   - QRコードモーダルが表示される
   - 家族コードが表示される
   - 「家族コードをコピー」ボタンが動作する
   - 「家族コードを共有」ボタンが動作する

#### C. 家族グループ参加テスト
1. 新しいデバイス/アプリインスタンス
2. 家族タブ → 「既存の家族グループに参加」
3. 家族コード入力（6桁の数字）
4. あなたの名前入力（例：「花子」）
5. 「家族グループを検索」ボタン押下
6. **期待結果**：
   - 家族グループ情報が表示される
   - 「参加する」ボタンで参加完了
   - ホーム画面に遷移する

#### D. QRコードスキャンテスト
1. 家族グループ参加画面
2. 「QRコードをスキャン」ボタン押下
3. カメラ権限許可
4. QRコードをスキャン
5. **期待結果**：
   - QRコードが認識される
   - 家族コードが自動入力される
   - 参加処理が実行される

#### E. 既存機能への影響テスト
1. **家族メンバー管理**：
   - 家族メンバーの追加/編集/削除が正常動作
   - 家族グループ情報が正しく表示される

2. **食事出席管理**：
   - 個人回答機能が正常動作
   - 出席データが正しく保存される

3. **スケジュール機能**：
   - カレンダー表示が正常動作
   - 週/月切り替えが正常動作

4. **ナビゲーション**：
   - 全タブ間の遷移が正常動作
   - 戻るボタンが正常動作

### エラーケーステスト
1. **無効な家族コード**：
   - 存在しないコード入力 → エラーメッセージ表示
   - 不正な形式入力 → バリデーションエラー表示

2. **ネットワークエラー**：
   - オフライン状態での動作確認
   - エラーハンドリングの確認

3. **権限エラー**：
   - カメラ権限拒否時の動作確認
   - 適切なフォールバック表示

### パフォーマンステスト
1. **起動時間**：3秒以内でのアプリ起動
2. **レスポンス時間**：各操作が1秒以内で完了
3. **メモリ使用量**：異常な増加がないこと

## 8. AIへの指示（Cursor用）
- この rules.md を常に参照し、作業開始時に **Task Header** を提示すること
- 計画→設計→差分→テスト手順→ドキュ更新まで一貫して出すこと
- 進捗や結果は `.md` ファイルに追記して記録すること
- 新しいルールや知見が出たら、自ら `rules.md` や `docs/*.md` に提案を追記すること
- **機能追加時は必ずテスト手順を提示し、テスト実行を支援すること**
